<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>전기차 충전소 지도</title>
    <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=9cc35d8f9e7435ff9fe2a4eb25f11087"></script>
    <style>
        body { margin: 0; font-family: Arial, sans-serif; }
        #header img { height: 40px; }
        #header nav { display: flex; gap: 20px; }
        #header nav a { color: white; text-decoration: none; }
        #map { flex: 3; height: 100%; }
        #infoPanel h2 { margin-top: 0; }
        #infoPanel ul { list-style: none; padding: 0; }
        #infoPanel ul li { margin: 5px 0; padding: 5px; background: #eaeaea; border-radius: 5px; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 999; display: none; }
        .modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 400px; max-height: 70%; background: white; border-radius: 10px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); z-index: 1000; overflow: hidden; }
        .modal .close { position: absolute; top: 10px; right: 15px; font-size: 20px; cursor: pointer; }
        .dropdown-menu .options { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 10px; }
    </style>
</head>
<body>
<header>
    <nav>
        <a href="/" th:href="@{/}" class="logo">로고</a>
        <div class="menu">
            <button th:if="${user == null}" th:href="@{/login}">로그인</button>
            <button th:if="${user == null}" th:href="@{/signup}">회원가입</button>
            <button th:if="${user != null}" th:href="@{/logout}">로그아웃</button>
            <a th:if="${user != null}" th:href="@{/mypage}">마이페이지</a>
            <a th:if="${user != null}" th:href="@{/reservations}">결제 및 예약</a>
        </div>
    </nav>
</header>

<main>
    <section id="map">
        <div id="kakaoMap" style="width:100%; height:500px;"></div>
    </section>

    <section id="stations">
        <h2>주변 충전소</h2>
        <ul>
            <!-- 충전소 목록을 반복하여 출력 -->
            <li th:each="station : ${stations}">
                <h3 th:text="${station.name}">충전소 이름</h3>
                <p th:text="${station.address}">충전소 주소</p>
                <p th:text="'사용 가능: ' + ${station.availableCharger} + ' / ' + ${station.totalCharger}">충전기 상태</p>
            </li>
        </ul>
    </section>
</main>

<script>
    // 카카오 지도 초기화
    var mapContainer = document.getElementById('kakaoMap');
    var mapOption = {
        center: new kakao.maps.LatLng(37.5665, 126.9780), // 기본 중심 (서울시청)
        level: 3
    };
    var map = new kakao.maps.Map(mapContainer, mapOption);

    // 서버에서 전달받은 충전소 데이터를 배열로 변환
    var stations = /*[[${stations}]]*/ [];

    // 충전소 데이터 마커로 표시
    stations.forEach(function(station) {
        var markerPosition = new kakao.maps.LatLng(station.latitude, station.longitude);
        var marker = new kakao.maps.Marker({
            position: markerPosition
        });
        marker.setMap(map);

        // 마커 클릭 시, 정보 표시
        var infowindow = new kakao.maps.InfoWindow({
            content: '<div style="padding:5px;">' + station.name + '<br>' + station.address + '</div>'
        });

        kakao.maps.event.addListener(marker, 'click', function() {
            infowindow.open(map, marker);
        });
    });
</script>
</body>
</html>
